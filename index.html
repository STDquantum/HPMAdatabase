<!DOCTYPE html>
<html lang="zh">

<head>
    <meta charset="UTF-8">
    <title>æ¸¸æˆæ•°æ®åº“å±•ç¤ºï¼ˆå¸¦ç­›é€‰ï¼‰</title>
    <style>
        body {
            font-family: sans-serif;
            margin: 20px;
            background: #f9f9f9;
        }

        h1 {
            border-bottom: 2px solid #333;
            padding-bottom: 5px;
        }

        .card,
        .cloth {
            background: #fff;
            border: 1px solid #ddd;
            border-radius: 5px;
            padding: 15px;
            margin: 10px 0;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        img {
            max-width: 90%;
            margin: 5px;
        }

        .rarity {
            font-weight: bold;
        }

        .category {
            font-style: italic;
        }

        select {
            margin: 10px 0;
            padding: 5px;
        }
    </style>
</head>

<body>
    <h1>ğŸ‘• è¡£æœåˆ—è¡¨</h1>
    <div>
        <label>æ—¶é—´æ’åº:
            <input type="radio" name="dateOrder" value="asc"> æ­£åº
            <input type="radio" name="dateOrder" value="desc" checked> å€’åº
        </label>
        <label style="margin-left:20px;">æ’åºä¼˜å…ˆ:
            <input type="radio" name="sortPriority" value="group"> ç»„ä¼˜å…ˆ
            <input type="radio" name="sortPriority" value="date" checked> æ—¶é—´ä¼˜å…ˆ
        </label>
    </div>
    <div id="groupFilters" style="margin:10px 0; padding:5px; border:1px solid #ccc; background:#fff;">
        <strong>ç­›é€‰ç»„:</strong>
        <!-- è¿™é‡ŒåŠ¨æ€ç”Ÿæˆå¤é€‰æ¡† -->
    </div>
    <div id="clothes"></div>

    <script>
        let allClothes = [];
        function loadClothes() {
            fetch('hpma_database.json')
                .then(response => response.json()).then(data => {
                    allClothes = data;
                    renderGroupFilters();  // å…ˆæ¸²æŸ“åˆ†ç»„å¤é€‰æ¡†
                    renderClothes();
                });
        }

        // ============ æ¸²æŸ“å¤é€‰æ¡† ============ 
        function renderGroupFilters() {
            const groupedTypes = [...new Set(allClothes.map(c => c.type || "æœªåˆ†ç±»"))].sort();
            const container = document.getElementById("groupFilters");

            // å…ˆæ”¾æŒ‰é’®
            container.innerHTML = `
                <strong>ç­›é€‰ç»„:</strong>
                <button id="toggleSelectAll" style="margin-left:10px;">å…¨ä¸é€‰</button>
                <br>
            `;

            // ç”Ÿæˆå¤é€‰æ¡†
            groupedTypes.forEach(type => {
                const id = "filter-" + type;
                container.innerHTML += `
                    <label style="margin-right:10px;margin-top:10px;display:inline-block;">
                        <input type="checkbox" class="group-filter" value="${type}" checked> ${type}
                    </label>
                `;
            });

            // ç»™æŒ‰é’®ç»‘å®šäº‹ä»¶
            const toggleBtn = document.getElementById("toggleSelectAll");
            toggleBtn.addEventListener("click", () => {
                const checkboxes = document.querySelectorAll(".group-filter");
                const allChecked = Array.from(checkboxes).every(cb => cb.checked);

                checkboxes.forEach(cb => cb.checked = !allChecked);

                // åˆ‡æ¢æŒ‰é’®æ–‡å­—
                toggleBtn.textContent = allChecked ? "å…¨é€‰" : "å…¨ä¸é€‰";

                renderClothes();
            });
        }


        function getSortOptions() {
            const dateOrder = document.querySelector('input[name="dateOrder"]:checked').value;
            const sortPriority = document.querySelector('input[name="sortPriority"]:checked').value;
            return { dateOrder, sortPriority };
        }

        // ============ è¡£æœå±•ç¤º ============ 
        function renderClothes() {
            const clothes = allClothes;
            const { dateOrder, sortPriority } = getSortOptions();

            // è·å–å‹¾é€‰çš„ç»„
            const selectedGroups = Array.from(document.querySelectorAll(".group-filter:checked"))
                .map(cb => cb.value);

            function dateCompare(a, b) {
                const aDate = a.date || "";
                const bDate = b.date || "";
                if (aDate === bDate) return 0;
                if (aDate === "") return 1;
                if (bDate === "") return -1;
                return dateOrder === "asc" ? aDate.localeCompare(bDate) : bDate.localeCompare(aDate);
            }

            // åˆ†ç»„
            const grouped = {};
            clothes.forEach(item => {
                const type = item.type || "æœªåˆ†ç±»";
                if (!grouped[type]) grouped[type] = [];
                grouped[type].push(item);
            });

            const container = document.getElementById("clothes");
            container.innerHTML = "";

            let sections = [];

            if (sortPriority === "group") {
                for (const type of Object.keys(grouped).sort()) {
                    if (!selectedGroups.includes(type)) continue; // åªæ˜¾ç¤ºå‹¾é€‰ç»„
                    const sortedClothes = grouped[type].slice().sort(dateCompare);
                    sections.push({ type, clothes: sortedClothes });
                }
            } else if (sortPriority === "date") {
                const sortedAll = clothes.slice().sort(dateCompare);
                sortedAll.forEach(cloth => {
                    const type = cloth.type || "æœªåˆ†ç±»";
                    if (selectedGroups.includes(cloth.type)) {
                        sections.push({ type, clothes: [cloth]});
                    }
                });
            }

            sections.forEach(sectionData => {
                const section = document.createElement("div");
                section.innerHTML = `<h2>ç±»å‹: ${sectionData.type}</h2>`;
                sectionData.clothes.forEach(cloth => {
                    const div = document.createElement("div");
                    div.className = "cloth";
                    div.innerHTML = `
                <h3>
                    ${cloth.name}
                    <span style="font-size:0.9em;color:#888;">ï¼ˆä¸Šçº¿æ—¥æœŸ: ${cloth.date || "æœªçŸ¥"}ï¼‰</span>
                </h3>
                <div>
                ${cloth.images.map(img => `
                    <div style="display:inline-block;text-align:center;margin:5px;">
                        <img src="${img.url}" alt="è¡£æœå›¾">
                        <div style="font-size:0.85em;color:#666;">${img.name || ""}</div>
                    </div>
                `).join("")}
                </div>
            `;
                    section.appendChild(div);
                });
                container.appendChild(section);
            });
        }

        // ç›‘å¬æ§ä»¶å˜åŒ–
        document.addEventListener("change", function (e) {
            if (e.target.name === "dateOrder" || e.target.name === "sortPriority" || e.target.classList.contains("group-filter")) {
                renderClothes();
            }
        });

        // ...existing code...

        loadClothes();
    </script>
</body>

</html>